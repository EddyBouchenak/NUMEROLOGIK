<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chargement...</title>
    <style>
        body {
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: #333;
            font-family: sans-serif;
            overflow: hidden;
        }

        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <span class="loader"></span>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB2P0UV83Z5cKccaKLLSDslsFD44vqRIP8",
            authDomain: "numerologik-cc8f9.firebaseapp.com",
            databaseURL: "https://numerologik-cc8f9-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "numerologik-cc8f9",
            storageBucket: "numerologik-cc8f9.firebasestorage.app",
            messagingSenderId: "177427869550",
            appId: "1:177427869550:web:4d20ede8feb9348189db7f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const statusRef = ref(db, 'numerologik/status');

        let hasRedirected = false;

        // Check Local Override FIRST
        if (localStorage.getItem('numerologik_override') === 'true') {
            window.location.replace('Homepage/index.html');
            hasRedirected = true;
        }

        if (!hasRedirected) {
            onValue(statusRef, (snapshot) => {
                if (hasRedirected) return;

                const val = snapshot.val();
                const isActive = val && val.active === true;

                if (isActive) {
                    window.location.replace('Homepage/index.html');
                } else {
                    window.location.replace('accueil/index.html');
                }
                hasRedirected = true;
            }, (error) => {
                // En cas d'erreur (ex: pas de réseau), on redirige vers le site clean par sécurité
                if (!hasRedirected) {
                    window.location.replace('accueil/index.html');
                    hasRedirected = true;
                }
            });

            // Sécurité timeout : si pas de réponse Firebase en 3s -> Clean Site
            setTimeout(() => {
                if (!hasRedirected) {
                    window.location.replace('accueil/index.html');
                    hasRedirected = true;
                }
            }, 3000);
        }
    </script>
</body>

</html>